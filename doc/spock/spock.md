**参考地址**
https://segmentfault.com/a/1190000022960319?utm_source=tag-newest

## 声明测试类
测试类是一个 Groovy 类，必须继承 spock.lang.Specification，规范的测试类名称一般是XxxSpec
## 字段
非静态字段可以在固定方法中使用，推荐在声明时同时初始化（在 setup() 方法中初始化也是一样的）
通过将字段标记为 @Shared，可以使字段成为共享字段

静态字段只应该用作常量。
共享字段完全可以取代静态变量的作用，且共享字段在语义上更明确

## 固定方法
```java
def setup() {}          // 每个测试方法开始前都会执行一遍
def cleanup() {}        // 每个测试方法后都会执行一遍
def setupSpec() {}     // 在第一个测试方法开始前执行一遍
def cleanupSpec() {}   // 最后一个测试方法后执行
```
## 测试方法
一个测试方法应该由4部分组成：
    1. Setup：环境初始化（可选）
    2. Stimulus：调用待测试代码
    3. Response：描述预期行为
    4. Cleanup：清理资源（可选）
### 块

setup

    对当前测试方法的环境进行初始化,一定是第一个执行的(别名为given)
    
when和then

    绑定在一块使用的,when 块可以是任意代码，但是 then 中的语句仅限于布尔表达式
    thrown() 和 notThrown(),用于描述 when 块中是否应该抛出异常
    
except

    then块的一个简化版
    调用待测试代码和描述期望行为都有很简单时使用
cleanup

    只能跟where块,或者放在测试方法最后
    用于清理当前测试方法使用的资源
    测试没有通过，该块也会执行,类似于java的finally
    
where

    where 块一定是放在方法的最后，如果有的话，用于写数据驱动的测试方法
    虽然 where 块放在最后，但却是第一个执行的
    
## 辅助方法

    测试方法很庞大或包含大量冗余代码，需要辅助方法抽离代码
    
with(target, closure)

    仅在 expect 或 then 块中才能调用：
    不需要像辅助方法中那样写很多 assert 了。
    
and 标签可以放在任何地方

## 基础扩展注解

    @Timeout：标记测试方法，设置其执行的超时时间，超时就测试不通过
    @Ignore：忽略标记的测试方法。
    @IgnoreRest：忽略其他没有该注解的测试方法。
    @FailsWith：标记测试方法，表明该测试方法的预期行为就是测试不通过
    
    @Unroll 用于标记测试方法，作用是报告测试结果时以测试用例为基本单位，而不是测试方法
    
## 数据管道

    数据表只是数据管道的语法糖
    数据管道用左 shift（ << ）操作符声明，左边是测试变量，右边是提供数据的管道
    
## 交互驱动测试

    交互驱动测试关注的是被测试对象和外部协作者之间的交互行为，而不是被测试对象的内部状态
    
### mocking 框架
mock框架的三个作用
1. 快速生成 mock 对象（一般使用 JDK 动态代理）
2. 定义被测试对象和协作者的预期交互行为
3. 验证定义好的预期交互行为

####创建mock对象
Mock 对象的真实类型其实是被代理对象的子类型，这里其实是一种多态的写法
```java
def subscriber = Mock(Subscriber)
Subscriber subscriber = Mock() # 自动推断要 mock 的对象的类型
```
    
    
    